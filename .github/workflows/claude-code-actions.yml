name: AI Tech Catchup with Claude Code Actions

on:
  workflow_dispatch:
  schedule:
    # æ¯Žé€±é‡‘æ›œæ—¥ 9:00 (UTC)
    - cron: '0 9 * * 5'

jobs:
  ai-tech-catchup-claude-code:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      pull-requests: read
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Set up Claude Code
        uses: anthropic/claude-code-action@v1
        with:
          claude_token: ${{ secrets.CLAUDE_TOKEN }}
          working_directory: '.'
          model: 'claude-3-5-sonnet-20241022'

      - name: Run AI Tech Catchup (make run equivalent)
        run: |
          echo "ðŸ¤– AI Tech Catchup Agent - Claude Code Actions"
          echo "=============================================="
          echo "ðŸ“Š æœ€æ–°AIæŠ€è¡“å‹•å‘ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­..."

          claude-code run --prompt "
          AI Tech Catchup Agent ã®æœ€æ–°AIæŠ€è¡“å‹•å‘ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

          ## å®Ÿè¡Œæ¡ä»¶
          - ç¾åœ¨ã®æ—¥ä»˜: $(date '+%Yå¹´%mæœˆ%dæ—¥')
          - è¨€èªž: æ—¥æœ¬èªž

          ## ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§
          prompts/default.yaml ã® default_search ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€
          Webæ¤œç´¢æ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã¦æœ€æ–°ã®AIæŠ€è¡“å‹•å‘ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

          ## å‡ºåŠ›å½¢å¼
          - è©³ç´°ãªãƒ¬ãƒãƒ¼ãƒˆå†…å®¹
          - å„æƒ…å ±æºã®URL
          - å…·ä½“çš„ãªäº‹ä¾‹ã¨æ•°å€¤ãƒ‡ãƒ¼ã‚¿
          - é–‹ç™ºè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ
          - AIç ”ç©¶è€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ
          - SNSãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å‹•å‘
          - OSSå‹•å‘
          "

      - name: Create GitHub Issue
        run: |
          echo "ðŸ“ GitHub Issueã‚’ä½œæˆä¸­..."

          # Claude Codeã®å‡ºåŠ›ã‚’å–å¾—
          REPORT_CONTENT=$(cat claude-code-output.md 2>/dev/null || echo "ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ")

          # Issueã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç”Ÿæˆ
          TITLE="ðŸ¤– AI Tech Catchup Report - $(date '+%Y-%m-%d')"

          # GitHub Issueã‚’ä½œæˆ
          gh issue create \
            --title "$TITLE" \
            --body "## $TITLE

          - **å®Ÿè¡Œæ—¥æ™‚**: $(date '+%Yå¹´%mæœˆ%dæ—¥ %H:%M')
          - **ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«**: claude-3-5-sonnet-20241022
          - **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: ${{ github.workflow }}

          ---

          $REPORT_CONTENT

          ---

          *ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯ Claude Code Actions ã«ã‚ˆã£ã¦è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚*" \
            --label "ai-report,claude-code" \
            --repo ${{ github.repository }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create summary
        if: always()
        run: |
          echo "## ðŸ¤– Claude Code Actions Execution Summary" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Ÿè¡Œæ—¥æ™‚**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒªãƒã‚¸ãƒˆãƒª**: ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: ${{ github.workflow }}" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Ÿè¡Œçµæžœ**: ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "- **ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«**: claude-3-5-sonnet-20241022" >> $GITHUB_STEP_SUMMARY
