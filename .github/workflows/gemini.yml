name: 'ğŸ¤– Gemini CLI - On-Demand Assistant'

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

jobs:
  gemini-assistant:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Gemini CLI
        id: gemini
        uses: google-github-actions/run-gemini-cli@v0
        with:
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          gemini_model: ${{ vars.GEMINI_MODEL }}
          prompt: |-
            ã‚ãªãŸã¯ AI æŠ€è¡“ã«è©³ã—ã„ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚

            ã€æŒ‡ç¤ºã€‘
            - å¿…ãšæ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„
            - ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ã«é–¢ã™ã‚‹è³ªå•ã®å ´åˆã¯ã€Issue æœ¬æ–‡ã®å†…å®¹ã‚„ Web ä¸Šã®æƒ…å ±ã«åŸºã¥ã„ã¦å›ç­”ã—ã¦ãã ã•ã„
            - æŠ€è¡“çš„ãªè³ªå•ã«ã¯ã€è©³ç´°ãªèª¬æ˜ã¨å‚è€ƒãƒªãƒ³ã‚¯ã‚’å«ã‚ã¦ãã ã•ã„
            - å¿…è¦ã«å¿œã˜ã¦ã€è¿½åŠ ã®èª¿æŸ»ã‚„æƒ…å ±æºã‚’ææ¡ˆã—ã¦ãã ã•ã„
            - å›ç­”ã¯æ˜ç¢ºã§åˆ†ã‹ã‚Šã‚„ã™ãæ§‹é€ åŒ–ã—ã¦ãã ã•ã„

            ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€‘
            Issue ã‚¿ã‚¤ãƒˆãƒ«: ${{ github.event.issue.title || github.event.pull_request.title }}
            Issue æœ¬æ–‡: ${{ github.event.issue.body || github.event.pull_request.body }}
            ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚³ãƒ¡ãƒ³ãƒˆ: ${{ github.event.comment.body }}

      - name: Post Gemini response as comment
        if: always() && steps.gemini.outputs.summary != ''
        uses: actions/github-script@v7
        with:
          script: |-
            const response = `${{ steps.gemini.outputs.summary }}`;
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: ${{ github.event.issue.number || github.event.pull_request.number }},
              body: response
            });
